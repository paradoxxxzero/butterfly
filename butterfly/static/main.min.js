/*! butterfly           2015-03-29 */

(function(){var a,b,c,d,e,f,g,h,i,j=[].slice,k=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=h=null,g=!1,f=(new Date).getTime(),a=document.querySelectorAll.bind(document),document.addEventListener("DOMContentLoaded",function(){var b,d,e,h,i,k,l;return h=function(a){return k.send("S"+a)},e=function(){var a,b,c;return c=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],b=a.join(","),"Resize"===c?k.send("R"+b):void 0},l="https:"===location.protocol?"wss://":"ws://",l+=document.location.host+"/ws"+location.pathname,k=new WebSocket(l),k.addEventListener("open",function(){return console.log("WebSocket open",arguments),k.send("R"+i.cols+","+i.rows),f=(new Date).getTime()}),k.addEventListener("error",function(){return console.log("WebSocket error",arguments)}),k.addEventListener("message",function(a){return setTimeout(function(){return i.write(a.data)},1)}),k.addEventListener("close",function(){return console.log("WebSocket closed",arguments),setTimeout(function(){return i.write("Closed"),i.skipNextKey=!0,i.element.classList.add("dead")},1),g=!0,(new Date).getTime()-f>6e4?open("","_self").close():void 0}),i=new c(a("#wrapper")[0],h,e),addEventListener("beforeunload",function(){return g?void 0:"This will exit the terminal session"}),b=function(a){var b,c;for(null==a&&(a=1e8),b="";b.length<a;)b+=Math.random().toString(36).substring(2);return c=(new Date).getTime(),i.write(b),console.log(""+a+" chars in "+((new Date).getTime()-c)+" ms")},d=function(a){var b,c;for(null==a&&(a=1e8),b="";b.length<a;)b+="["+(30+parseInt(20*Math.random()))+"m",b+=Math.random().toString(36).substring(2);return c=(new Date).getTime(),i.write(b),console.log(""+a+" chars + colors in "+((new Date).getTime()-c)+" ms")},i.ws=k,window.butterfly=i}),d=function(a){return a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,!1},i=0,b={normal:i++,escaped:i++,csi:i++,osc:i++,charset:i++,dcs:i++,ignore:i++},c=function(){function a(a,b,c){var d,e,f;for(this.parent=a,this.out=b,this.ctl=null!=c?c:function(){},this.context=this.parent.ownerDocument.defaultView,this.document=this.parent.ownerDocument,this.body=this.document.getElementsByTagName("body")[0],this.element=this.document.createElement("div"),this.element.className="terminal focus",this.element.style.outline="none",this.element.setAttribute("tabindex",0),this.element.setAttribute("spellcheck","false"),this.parent.appendChild(this.element),d=this.document.createElement("div"),d.className="line",this.element.appendChild(d),this.children=[d],this.compute_char_size(),d.style.height=this.char_size.height+"px",f=this.parent.getBoundingClientRect(),this.cols=Math.floor(f.width/this.char_size.width),this.rows=Math.floor(f.height/this.char_size.height),e=this.rows-1;e--;)d=this.document.createElement("div"),d.style.height=this.char_size.height+"px",d.className="line",this.element.appendChild(d),this.children.push(d);this.scrollback=1e5,this.visualBell=100,this.convertEol=!1,this.termName="xterm",this.cursorBlink=!0,this.cursorState=0,this.last_cc=0,this.reset_vars(),this.refresh(0,this.rows-1),this.focus(),this.startBlink(),addEventListener("keydown",this.keyDown.bind(this)),addEventListener("keypress",this.keyPress.bind(this)),addEventListener("focus",this.focus.bind(this)),addEventListener("blur",this.blur.bind(this)),addEventListener("resize",this.resize.bind(this)),"undefined"!=typeof InstallTrigger&&(this.element.contentEditable="true",this.element.addEventListener("mouseup",function(){var a;return a=getSelection().getRangeAt(0),a.startOffset===a.endOffset?getSelection().removeAllRanges():void 0})),this.initmouse(),setTimeout(this.resize.bind(this),100)}return a.prototype.reset_vars=function(){var a;for(this.ybase=0,this.ydisp=0,this.x=0,this.y=0,this.cursorHidden=!1,this.state=b.normal,this.queue="",this.scrollTop=0,this.scrollBottom=this.rows-1,this.applicationKeypad=!1,this.applicationCursor=!1,this.originMode=!1,this.wraparoundMode=!1,this.normal=null,this.charset=null,this.gcharset=null,this.glevel=0,this.charsets=[null],this.defAttr=131840,this.curAttr=this.defAttr,this.params=[],this.currentParam=0,this.prefix="",this.lines=[],a=this.rows;a--;)this.lines.push(this.blankLine());return this.setupStops(),this.skipNextKey=null},a.prototype.compute_char_size=function(){var a;return a=document.createElement("span"),a.textContent="0123456789",this.children[0].appendChild(a),this.char_size={width:a.getBoundingClientRect().width/10,height:this.children[0].getBoundingClientRect().height},this.children[0].removeChild(a)},a.prototype.eraseAttr=function(){return-512&this.defAttr|511&this.curAttr},a.prototype.focus=function(){return this.sendFocus&&this.send("[I"),this.showCursor(),this.element.classList.add("focus"),this.element.classList.remove("blur")},a.prototype.blur=function(){return this.cursorState=1,this.refresh(this.y,this.y),this.sendFocus&&this.send("[O"),this.element.classList.add("blur"),this.element.classList.remove("focus")},a.prototype.initmouse=function(){var a,b,c,e,f,g,h;return e=32,f=function(a){var d,f;if(d=b(a),f=c(a))switch(g(d,f),a.type){case"mousedown":return e=d;case"mouseup":return e=32}},h=function(a){var b,d;return b=e,(d=c(a))?(b+=32,g(b,d)):void 0},a=function(a){return function(b,c){return a.utfMouse?2047===c?b.push(0):127>c?b.push(c):(c>2047&&(c=2047),b.push(192|c>>6),b.push(128|63&c)):255===c?b.push(0):(c>127&&(c=127),b.push(c))}}(this),g=function(b){return function(c,d){var e;return b.urxvtMouse?(d.x-=32,d.y-=32,d.x++,d.y++,void b.send("["+c+";"+d.x+";"+d.y+"M")):b.sgrMouse?(d.x-=32,d.y-=32,void b.send("[<"+(3===(3&c)?-4&c:c)+";"+d.x+";"+d.y+(3===(3&c)?"m":"M"))):(e=[],a(e,c),a(e,d.x),a(e,d.y),b.send("[M"+String.fromCharCode.apply(String,e)))}}(this),b=function(a){return function(b){var c,d,e,f,g;switch(b.type){case"mousedown":c=null!=b.button?+b.button:null!=b.which?b.which-1:null;break;case"mouseup":c=3;break;case"wheel":c=b.deltaY<0?64:65}return g=b.shiftKey?4:0,e=b.metaKey?8:0,d=b.ctrlKey?16:0,f=g|e|d,a.vt200Mouse?f&=d:a.normalMouse||(f=0),32+(f<<2)+c}}(this),c=function(a){return function(b){var c,d,e,f,g;for(f=b.pageX,g=b.pageY,c=a.element;c&&c!==a.document.documentElement;)f-=c.offsetLeft,g-=c.offsetTop,c="offsetParent"in c?c.offsetParent:c.parentNode;return e=a.element.clientWidth,d=a.element.clientHeight,f=Math.ceil(f/e*a.cols),g=Math.ceil(g/d*a.rows),0>f&&(f=0),f>a.cols&&(f=a.cols),0>g&&(g=0),g>a.rows&&(g=a.rows),f+=32,g+=32,{x:f,y:g,type:b.type}}}(this),addEventListener("mousedown",function(a){return function(b){var c,e;if(a.mouseEvents)return f(b),a.vt200Mouse?(f({__proto__:b,type:"mouseup"}),d(b)):(c=h.bind(a),a.normalMouse&&addEventListener("mousemove",c),a.x10Mouse||addEventListener("mouseup",e=function(b){return f(b),a.normalMouse&&removeEventListener("mousemove",c),removeEventListener("mouseup",e),d(b)}),d(b))}}(this)),addEventListener("wheel",function(a){return function(b){if(a.mouseEvents){if(a.x10Mouse)return;f(b)}else{if(a.applicationKeypad)return;a.scrollDisp(b.deltaY>0?5:-5)}return d(b)}}(this))},a.prototype.refresh=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(b-a>=this.rows/3&&(m=this.element.parentNode,null!=m&&m.removeChild(this.element)),o=this.cols+1,q=a,b>=this.lines.length&&(b=this.lines.length-1);b>=q;){for(n=q+this.ydisp,k=this.lines[n],l="",p=q!==this.y||this.ydisp!==this.ybase&&!this.selectMode||this.cursorHidden?-(1/0):this.x,c=this.defAttr,j=0;j<k.length;){if(g=k[j][0],e=k[j][1],g!==c&&(c!==this.defAttr&&(l+="</span>"),g!==this.defAttr&&(f=[],l+="<span ",d=511&g,h=g>>9&511,i=g>>18,1&i&&f.push("bold"),2&i&&f.push("underline"),4&i&&f.push("blink"),8&i&&f.push("reverse-video"),16&i&&f.push("invisible"),1&i&&8>h&&(h+=8),f.push("bg-color-"+d),f.push("fg-color-"+h),l+='class="',l+=f.join(" "),l+='">')),j===p&&(l+='<span class="'+(this.cursorState?"reverse-video ":"")+'cursor">'),e.length>1)l+=e;else switch(e){case"&":l+="&amp;";break;case"<":l+="&lt;";break;case">":l+="&gt;";break;default:" "===e?l+='<span class="nbsp"> </span>':" ">=e?l+="&nbsp;":(e>"＀"&&"￯">e&&j++,l+=e)}j===p&&(l+="</span>"),c=g,j++}c!==this.defAttr&&(l+="</span>"),this.children[q].innerHTML=l,q++}return null!=m?m.appendChild(this.element):void 0},a.prototype._cursorBlink=function(){var a;return this.cursorState^=1,(a=this.element.querySelector(".cursor"))?a.classList.contains("reverse-video")?a.classList.remove("reverse-video"):a.classList.add("reverse-video"):void 0},a.prototype.showCursor=function(){return this.cursorState?void 0:(this.cursorState=1,this.refresh(this.y,this.y))},a.prototype.startBlink=function(){return this.cursorBlink?(this._blinker=function(a){return function(){return a._cursorBlink()}}(this),this.t_blink=setInterval(this._blinker,500)):void 0},a.prototype.refreshBlink=function(){return this.cursorBlink?(clearInterval(this.t_blink),this.t_blink=setInterval(this._blinker,500)):void 0},a.prototype.scroll=function(){var a;return++this.ybase===this.scrollback&&(this.ybase=this.ybase/2|0,this.lines=this.lines.slice(-(this.ybase+this.rows)+1)),this.ydisp=this.ybase,a=this.ybase+this.rows-1,a-=this.rows-1-this.scrollBottom,a===this.lines.length?this.lines.push(this.blankLine()):this.lines.splice(a,0,this.blankLine()),0!==this.scrollTop&&(0!==this.ybase&&(this.ybase--,this.ydisp=this.ybase),this.lines.splice(this.ybase+this.scrollTop,1)),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},a.prototype.scrollDisp=function(a){return this.ydisp+=a,this.ydisp>this.ybase?this.ydisp=this.ybase:this.ydisp<0&&(this.ydisp=0),this.refresh(0,this.rows-1)},a.prototype.write=function(c){var d,e,f,g,h,i,j,k;for(this.refreshStart=this.y,this.refreshEnd=this.y,this.ybase!==this.ydisp&&(this.ydisp=this.ybase,this.maxRange()),f=0,h=c.length;h>f;){switch(d=c[f],this.state){case b.normal:switch(d){case"":this.bell();break;case"\n":case"":case"\f":this.convertEol&&(this.x=0),this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll());break;case"\r":this.x=0;break;case"\b":this.x>0&&this.x--;break;case"	":this.x=this.nextStop();break;case"":this.setgLevel(1);break;case"":this.setgLevel(0);break;case"":this.state=b.escaped;break;default:if(d>=" "&&((null!=(k=this.charset)?k[d]:void 0)&&(d=this.charset[d]),this.x>=this.cols&&(this.lines[this.y+this.ybase][this.x]=[this.curAttr,"⏎"],this.x=0,this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll())),this.lines[this.y+this.ybase][this.x]=[this.curAttr,d],this.x++,this.updateRange(this.y),d>"＀"&&"￯">d)){if(g=this.y+this.ybase,this.cols<2||this.x>=this.cols){this.lines[g][this.x-1]=[this.curAttr," "];break}this.lines[g][this.x]=[this.curAttr," "],this.x++}}break;case b.escaped:switch(d){case"[":this.params=[],this.currentParam=0,this.state=b.csi;break;case"]":this.params=[],this.currentParam=0,this.state=b.osc;break;case"P":this.params=[],this.currentParam=0,this.state=b.dcs;break;case"_":this.state=b.ignore;break;case"^":this.state=b.ignore;break;case"c":this.reset();break;case"E":this.x=0,this.index();break;case"D":this.index();break;case"M":this.reverseIndex();break;case"%":this.setgLevel(0),this.setgCharset(0,a.prototype.charsets.US),this.state=b.normal,f++;break;case"(":case")":case"*":case"+":case"-":case".":switch(d){case"(":this.gcharset=0;break;case")":case"-":this.gcharset=1;break;case"*":case".":this.gcharset=2;break;case"+":this.gcharset=3}this.state=b.charset;break;case"/":this.gcharset=3,this.state=b.charset,f--;break;case"n":this.setgLevel(2);break;case"o":this.setgLevel(3);break;case"|":this.setgLevel(3);break;case"}":this.setgLevel(2);break;case"~":this.setgLevel(1);break;case"7":this.saveCursor(),this.state=b.normal;break;case"8":this.restoreCursor(),this.state=b.normal;break;case"#":this.state=b.normal,f++;break;case"H":this.tabSet();break;case"=":this.applicationKeypad=!0,this.state=b.normal;break;case">":this.applicationKeypad=!1,this.state=b.normal;break;default:this.state=b.normal,console.log("Unknown ESC control:",d)}break;case b.charset:switch(d){case"0":e=a.prototype.charsets.SCLD;break;case"A":e=a.prototype.charsets.UK;break;case"B":e=a.prototype.charsets.US;break;case"4":e=a.prototype.charsets.Dutch;break;case"C":case"5":e=a.prototype.charsets.Finnish;break;case"R":e=a.prototype.charsets.French;break;case"Q":e=a.prototype.charsets.FrenchCanadian;break;case"K":e=a.prototype.charsets.German;break;case"Y":e=a.prototype.charsets.Italian;break;case"E":case"6":e=a.prototype.charsets.NorwegianDanish;break;case"Z":e=a.prototype.charsets.Spanish;break;case"H":case"7":e=a.prototype.charsets.Swedish;break;case"=":e=a.prototype.charsets.Swiss;break;case"/":e=a.prototype.charsets.ISOLatin,f++;break;default:e=a.prototype.charsets.US}this.setgCharset(this.gcharset,e),this.gcharset=null,this.state=b.normal;break;case b.osc:if(""===d||""===d){switch(""===d&&f++,this.params.push(this.currentParam),this.params[0]){case 0:case 1:case 2:this.params[1]&&(this.title=this.params[1]+" - ƸӜƷ butterfly",this.handleTitle(this.title))}this.params=[],this.currentParam=0,this.state=b.normal}else this.params.length?this.currentParam+=d:d>="0"&&"9">=d?this.currentParam=10*this.currentParam+d.charCodeAt(0)-48:";"===d&&(this.params.push(this.currentParam),this.currentParam="");break;case b.csi:if("?"===d||">"===d||"!"===d){this.prefix=d;break}if(d>="0"&&"9">=d){this.currentParam=10*this.currentParam+d.charCodeAt(0)-48;break}if("$"===d||'"'===d||" "===d||"'"===d)break;if(this.params.push(this.currentParam),this.currentParam=0,";"===d)break;switch(this.state=b.normal,d){case"A":this.cursorUp(this.params);break;case"B":this.cursorDown(this.params);break;case"C":this.cursorForward(this.params);break;case"D":this.cursorBackward(this.params);break;case"H":this.cursorPos(this.params);break;case"J":this.eraseInDisplay(this.params);break;case"K":this.eraseInLine(this.params);break;case"m":this.prefix||this.charAttributes(this.params);break;case"n":this.prefix||this.deviceStatus(this.params);break;case"@":this.insertChars(this.params);break;case"E":this.cursorNextLine(this.params);break;case"F":this.cursorPrecedingLine(this.params);break;case"G":this.cursorCharAbsolute(this.params);break;case"L":this.insertLines(this.params);break;case"M":this.deleteLines(this.params);break;case"P":this.deleteChars(this.params);break;case"X":this.eraseChars(this.params);break;case"`":this.charPosAbsolute(this.params);break;case"a":this.HPositionRelative(this.params);break;case"c":this.sendDeviceAttributes(this.params);break;case"d":this.linePosAbsolute(this.params);break;case"e":this.VPositionRelative(this.params);break;case"f":this.HVPosition(this.params);break;case"h":this.setMode(this.params);break;case"l":this.resetMode(this.params);break;case"r":this.setScrollRegion(this.params);break;case"s":this.saveCursor(this.params);break;case"u":this.restoreCursor(this.params);break;case"I":this.cursorForwardTab(this.params);break;case"S":this.scrollUp(this.params);break;case"T":this.params.length<2&&!this.prefix&&this.scrollDown(this.params);break;case"Z":this.cursorBackwardTab(this.params);break;case"b":this.repeatPrecedingCharacter(this.params);break;case"g":this.tabClear(this.params);break;case"p":"!"===this.prefix&&this.softReset(this.params);break;default:console.error("Unknown CSI code: %s.",d)}this.prefix="";break;case b.dcs:if(""===d||""===d){switch(""===d&&f++,this.prefix){case"":break;case"$q":switch(i=this.currentParam,j=!1,i){case'"q':i='0"q';break;case'"p':i='61"p';break;case"r":i=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r";break;case"m":i="0m";break;default:console.error("Unknown DCS Pt: %s.",i),i=""}this.send("P"+ +j+"$r"+i+"\\");break;case"+q":i=this.currentParam,j=!1,this.send("P"+ +j+"+r"+i+"\\");break;default:console.error("Unknown DCS prefix: %s.",this.prefix)}this.currentParam=0,this.prefix="",this.state=b.normal}else this.currentParam?this.currentParam+=d:this.prefix||"$"===d||"+"===d?2===this.prefix.length?this.currentParam=d:this.prefix+=d:this.currentParam=d;break;case b.ignore:(""===d||""===d)&&(""===d&&f++,this.state=b.normal)}f++}return this.updateRange(this.y),this.refresh(this.refreshStart,this.refreshEnd)},a.prototype.writeln=function(a){return this.write(""+a+"\r\n")},a.prototype.keyDown=function(a){var b,c,e,f;if(a.keyCode>15&&a.keyCode<19)return!0;if((a.shiftKey||a.ctrlKey)&&45===a.keyCode)return!0;if(a.shiftKey&&a.ctrlKey&&(67===(f=a.keyCode)||86===f))return!0;if(a.altKey&&90===a.keyCode&&!this.skipNextKey)return this.skipNextKey=!0,this.element.classList.add("skip"),d(a);if(this.skipNextKey)return this.skipNextKey=!1,this.element.classList.remove("skip"),!0;switch(a.keyCode){case 8:if(c=a.altKey?"":"",a.shiftKey){c+="\b";break}c+="";break;case 9:if(a.shiftKey){c="[Z";break}c="	";break;case 13:c="\r";break;case 27:c="";break;case 37:if(this.applicationCursor){c="OD";break}c="[D";break;case 39:if(this.applicationCursor){c="OC";break}c="[C";break;case 38:if(this.applicationCursor){c="OA";break}if(a.ctrlKey)return this.scrollDisp(-1),d(a);c="[A";break;case 40:if(this.applicationCursor){c="OB";break}if(a.ctrlKey)return this.scrollDisp(1),d(a);c="[B";break;case 46:c="[3~";break;case 45:c="[2~";break;case 36:if(this.applicationKeypad){c="OH";break}c="OH";break;case 35:if(this.applicationKeypad){c="OF";break}c="OF";break;case 33:if(a.shiftKey)return this.scrollDisp(-(this.rows-1)),d(a);c="[5~";break;case 34:if(a.shiftKey)return this.scrollDisp(this.rows-1),d(a);c="[6~";break;case 112:c="OP";break;case 113:c="OQ";break;case 114:c="OR";break;case 115:c="OS";break;case 116:c="[15~";break;case 117:c="[17~";break;case 118:c="[18~";break;case 119:c="[19~";break;case 120:c="[20~";break;case 121:c="[21~";break;case 122:c="[23~";break;case 123:c="[24~";break;default:if(a.ctrlKey)if(a.keyCode>=65&&a.keyCode<=90){if(67===a.keyCode){if(e=(new Date).getTime(),e-this.last_cc<75)for(b=setTimeout(function(){})-6,this.write("\r\n --8<------8<-- Sectioned --8<------8<-- \r\n\r\n");b--;)b!==this.t_bell&&b!==this.t_queue&&b!==this.t_blink&&clearTimeout(b);this.last_cc=e}c=String.fromCharCode(a.keyCode-64)}else 32===a.keyCode?c=String.fromCharCode(0):a.keyCode>=51&&a.keyCode<=55?c=String.fromCharCode(a.keyCode-51+27):56===a.keyCode?c=String.fromCharCode(127):219===a.keyCode?c=String.fromCharCode(27):221===a.keyCode&&(c=String.fromCharCode(29));else(a.altKey&&k.call(navigator.platform,"Mac")<0||a.metaKey&&k.call(navigator.platform,"Mac")>=0)&&(a.keyCode>=65&&a.keyCode<=90?c=""+String.fromCharCode(a.keyCode+32):192===a.keyCode?c="`":a.keyCode>=48&&a.keyCode<=57&&(c=""+(a.keyCode-48)))}return a.keyCode>=37&&a.keyCode<=40&&(a.ctrlKey?c=c.slice(0,-1)+"1;5"+c.slice(-1):a.altKey?c=c.slice(0,-1)+"1;3"+c.slice(-1):a.shiftKey&&(c=c.slice(0,-1)+"1;4"+c.slice(-1))),c?this.prefixMode?(this.leavePrefix(),d(a)):this.selectMode?(this.keySelect(a,c),d(a)):(this.showCursor(),this.handler(c),d(a)):!0},a.prototype.setgLevel=function(a){return this.glevel=a,this.charset=this.charsets[a]},a.prototype.setgCharset=function(a,b){return this.charsets[a]=b,this.glevel===a?this.charset=b:void 0},a.prototype.keyPress=function(a){var b;if(this.skipNextKey===!1)return this.skipNextKey=null,!0;if(d(a),a.charCode)b=a.charCode;else if(null==a.which)b=a.keyCode;else{if(0===a.which||0===a.charCode)return!1;b=a.which}return!b||a.ctrlKey||a.altKey||a.metaKey?!1:(b=String.fromCharCode(b),this.showCursor(),this.handler(b),!1)},a.prototype.send=function(a){return this.queue||(this.t_queue=setTimeout(function(a){return function(){return a.handler(a.queue),a.queue=""}}(this),1)),this.queue+=a},a.prototype.bell=function(a){return null==a&&(a="bell"),this.visualBell?(this.element.classList.add(a),this.t_bell=setTimeout(function(b){return function(){return b.element.classList.remove(a)}}(this),this.visualBell)):void 0},a.prototype.resize=function(){var a,b,c,d,e,f,g,h;if(f=this.cols,g=this.rows,this.compute_char_size(),h=this.parent.getBoundingClientRect(),this.cols=Math.floor(h.width/this.char_size.width),this.rows=Math.floor(h.height/this.char_size.height),f!==this.cols||g!==this.rows){if(this.ctl("Resize",this.cols,this.rows),f<this.cols)for(a=[this.defAttr," "],c=this.lines.length;c--;)for(;this.lines[c].length<this.cols;)this.lines[c].push(a);else if(f>this.cols)for(c=this.lines.length;c--;)for(;this.lines[c].length>this.cols;)this.lines[c].pop();if(this.setupStops(f),d=g,d<this.rows)for(b=this.element;d++<this.rows;)this.lines.length<this.rows+this.ybase&&this.lines.push(this.blankLine()),this.children.length<this.rows&&(e=this.document.createElement("div"),e.className="line",e.style.height=this.char_size.height+"px",b.appendChild(e),this.children.push(e));else if(d>this.rows)for(;d-->this.rows;)if(this.lines.length>this.rows+this.ybase&&this.lines.pop(),this.children.length>this.rows){if(b=this.children.pop(),!b)continue;b.parentNode.removeChild(b)}return this.y>=this.rows&&(this.y=this.rows-1),this.x>=this.cols&&(this.x=this.cols-1),this.scrollTop=0,this.scrollBottom=this.rows-1,this.refresh(0,this.rows-1),this.normal=null}},a.prototype.updateRange=function(a){return a<this.refreshStart&&(this.refreshStart=a),a>this.refreshEnd?this.refreshEnd=a:void 0},a.prototype.maxRange=function(){return this.refreshStart=0,this.refreshEnd=this.rows-1},a.prototype.setupStops=function(a){var b;for(null!=a?this.tabs[a]||(a=this.prevStop(a)):(this.tabs={},a=0),b=[];a<this.cols;)this.tabs[a]=!0,b.push(a+=8);return b},a.prototype.prevStop=function(a){for(null==a&&(a=this.x);!this.tabs[--a]&&a>0;);return a>=this.cols?this.cols-1:0>a?0:a},a.prototype.nextStop=function(a){for(null==a&&(a=this.x);!this.tabs[++a]&&a<this.cols;);return a>=this.cols?this.cols-1:0>a?0:a},a.prototype.eraseRight=function(a,b){var c,d;for(d=this.lines[this.ybase+b],c=[this.eraseAttr()," "];a<this.cols;)d[a]=c,a++;return this.updateRange(b)},a.prototype.eraseLeft=function(a,b){var c,d;for(d=this.lines[this.ybase+b],c=[this.eraseAttr()," "],a++;a--;)d[a]=c;return this.updateRange(b)},a.prototype.eraseLine=function(a){return this.eraseRight(0,a)},a.prototype.blankLine=function(a){var b,c,d,e;for(b=a?this.eraseAttr():this.defAttr,c=[b," "],e=[],d=0;d<this.cols+1;)e[d]=c,d++;return e},a.prototype.ch=function(a){return a?[this.eraseAttr()," "]:[this.defAttr," "]},a.prototype.isterm=function(a){return 0===(""+this.termName).indexOf(a)},a.prototype.handler=function(a){return this.out(a)},a.prototype.handleTitle=function(a){return document.title=a},a.prototype.index=function(){return this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll()),this.state=b.normal},a.prototype.reverseIndex=function(){var a;return this.y--,this.y<this.scrollTop&&(this.y++,this.lines.splice(this.y+this.ybase,0,this.blankLine(!0)),a=this.rows-1-this.scrollBottom,this.lines.splice(this.rows-1+this.ybase-a+1,1),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)),this.state=b.normal},a.prototype.reset=function(){return this.reset_vars(),this.refresh(0,this.rows-1)},a.prototype.tabSet=function(){return this.tabs[this.x]=!0,this.state=b.normal},a.prototype.cursorUp=function(a){var b;return b=a[0],1>b&&(b=1),this.y-=b,this.y<0?this.y=0:void 0},a.prototype.cursorDown=function(a){var b;return b=a[0],1>b&&(b=1),this.y+=b,this.y>=this.rows?this.y=this.rows-1:void 0},a.prototype.cursorForward=function(a){var b;return b=a[0],1>b&&(b=1),this.x+=b,this.x>=this.cols?this.x=this.cols-1:void 0},a.prototype.cursorBackward=function(a){var b;return b=a[0],1>b&&(b=1),this.x-=b,this.x<0?this.x=0:void 0},a.prototype.cursorPos=function(a){var b,c;return c=a[0]-1,b=a.length>=2?a[1]-1:0,0>c?c=0:c>=this.rows&&(c=this.rows-1),0>b?b=0:b>=this.cols&&(b=this.cols-1),this.x=b,this.y=c},a.prototype.eraseInDisplay=function(a){var b,c,d,e;switch(a[0]){case 0:for(this.eraseRight(this.x,this.y),b=this.y+1,c=[];b<this.rows;)this.eraseLine(b),c.push(b++);return c;case 1:for(this.eraseLeft(this.x,this.y),b=this.y,d=[];b--;)d.push(this.eraseLine(b));return d;case 2:for(b=this.rows,e=[];b--;)e.push(this.eraseLine(b));return e}},a.prototype.eraseInLine=function(a){switch(a[0]){case 0:return this.eraseRight(this.x,this.y);case 1:return this.eraseLeft(this.x,this.y);case 2:return this.eraseLine(this.y)}},a.prototype.charAttributes=function(a){var b,c,d,e,f,g;if(1===a.length&&0===a[0])return void(this.curAttr=this.defAttr);for(d=this.curAttr>>18,c=this.curAttr>>9&511,b=511&this.curAttr,f=a.length,e=0;f>e;)g=a[e],g>=30&&37>=g?c=g-30:g>=40&&47>=g?b=g-40:g>=90&&97>=g?(g+=8,c=g-90):g>=100&&107>=g?(g+=8,b=g-100):0===g?(d=this.defAttr>>18,c=this.defAttr>>9&511,b=511&this.defAttr):1===g?d|=1:4===g?d|=2:5===g?d|=4:7===g?d|=8:8===g?d|=16:22===g?d&=-2:24===g?d&=-3:25===g?d&=-5:27===g?d&=-9:28===g?d&=-17:39===g?c=this.defAttr>>9&511:49===g?b=511&this.defAttr:38===g?2===a[e+1]?(e+=2,c="#"+a[e]&255+a[e+1]&255+a[e+2]&255,e+=2):5===a[e+1]&&(e+=2,c=255&a[e]):48===g?2===a[e+1]?(e+=2,b="#"+a[e]&255+a[e+1]&255+a[e+2]&255,e+=2):5===a[e+1]&&(e+=2,b=255&a[e]):100===g?(c=this.defAttr>>9&511,b=511&this.defAttr):console.error("Unknown SGR attribute: %d.",g),e++;return this.curAttr=d<<18|c<<9|b},a.prototype.deviceStatus=function(a){if(this.prefix){if("?"===this.prefix&&6===a[0])return this.send("[?"+(this.y+1)+";"+(this.x+1)+"R")}else switch(a[0]){case 5:return this.send("[0n");case 6:return this.send("["+(this.y+1)+";"+(this.x+1)+"R")}},a.prototype.insertChars=function(a){var b,c,d,e,f;for(d=a[0],1>d&&(d=1),e=this.y+this.ybase,c=this.x,b=[this.eraseAttr()," "],f=[];d--&&c<this.cols;)this.lines[e].splice(c++,0,b),f.push(this.lines[e].pop());return f},a.prototype.cursorNextLine=function(a){var b;return b=a[0],1>b&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1),this.x=0},a.prototype.cursorPrecedingLine=function(a){var b;return b=a[0],1>b&&(b=1),this.y-=b,this.y<0&&(this.y=0),this.x=0},a.prototype.cursorCharAbsolute=function(a){var b;return b=a[0],1>b&&(b=1),this.x=b-1},a.prototype.insertLines=function(a){var b,c,d;for(c=a[0],1>c&&(c=1),d=this.y+this.ybase,b=this.rows-1-this.scrollBottom,b=this.rows-1+this.ybase-b+1;c--;)this.lines.splice(d,0,this.blankLine(!0)),this.lines.splice(b,1);return this.updateRange(this.y),this.updateRange(this.scrollBottom)},a.prototype.deleteLines=function(a){var b,c,d;for(c=a[0],1>c&&(c=1),d=this.y+this.ybase,b=this.rows-1-this.scrollBottom,b=this.rows-1+this.ybase-b;c--;)this.lines.splice(b+1,0,this.blankLine(!0)),this.lines.splice(d,1);return this.updateRange(this.y),this.updateRange(this.scrollBottom)},a.prototype.deleteChars=function(a){var b,c,d,e;for(c=a[0],1>c&&(c=1),d=this.y+this.ybase,b=[this.eraseAttr()," "],e=[];c--;)this.lines[d].splice(this.x,1),e.push(this.lines[d].push(b));return e},a.prototype.eraseChars=function(a){var b,c,d,e,f;for(d=a[0],1>d&&(d=1),e=this.y+this.ybase,c=this.x,b=[this.eraseAttr()," "],f=[];d--&&c<this.cols;)f.push(this.lines[e][c++]=b);return f},a.prototype.charPosAbsolute=function(a){var b;return b=a[0],1>b&&(b=1),this.x=b-1,this.x>=this.cols?this.x=this.cols-1:void 0},a.prototype.HPositionRelative=function(a){var b;return b=a[0],1>b&&(b=1),this.x+=b,this.x>=this.cols?this.x=this.cols-1:void 0},a.prototype.sendDeviceAttributes=function(a){if(!(a[0]>0))if(this.prefix){if(">"===this.prefix){if(this.isterm("xterm"))return this.send("[>0;276;0c");if(this.isterm("rxvt-unicode"))return this.send("[>85;95;0c");if(this.isterm("linux"))return this.send(a[0]+"c");if(this.isterm("screen"))return this.send("[>83;40003;0c")}}else{if(this.isterm("xterm")||this.isterm("rxvt-unicode")||this.isterm("screen"))return this.send("[?1;2c");if(this.isterm("linux"))return this.send("[?6c")}},a.prototype.linePosAbsolute=function(a){var b;return b=a[0],1>b&&(b=1),this.y=b-1,this.y>=this.rows?this.y=this.rows-1:void 0},a.prototype.VPositionRelative=function(a){var b;return b=a[0],1>b&&(b=1),this.y+=b,this.y>=this.rows?this.y=this.rows-1:void 0},a.prototype.HVPosition=function(a){return a[0]<1&&(a[0]=1),a[1]<1&&(a[1]=1),this.y=a[0]-1,this.y>=this.rows&&(this.y=this.rows-1),this.x=a[1]-1,this.x>=this.cols?this.x=this.cols-1:void 0},a.prototype.setMode=function(b){var c,d,e;if("object"!=typeof b){if("?"===this.prefix)switch(b){case 1:return this.applicationCursor=!0;case 2:return this.setgCharset(0,a.prototype.charsets.US),this.setgCharset(1,a.prototype.charsets.US),this.setgCharset(2,a.prototype.charsets.US),this.setgCharset(3,a.prototype.charsets.US);case 3:return this.savedCols=this.cols,this.resize(132,this.rows);case 6:return this.originMode=!0;case 7:return this.wraparoundMode=!0;case 66:return this.applicationKeypad=!0;case 9:case 1e3:case 1002:case 1003:return this.x10Mouse=9===b,this.vt200Mouse=1e3===b,this.normalMouse=b>1e3,this.mouseEvents=!0,this.element.style.cursor="pointer";case 1004:return this.sendFocus=!0;case 1005:return this.utfMouse=!0;case 1006:return this.sgrMouse=!0;case 1015:return this.urxvtMouse=!0;case 25:return this.cursorHidden=!1;case 1049:case 47:case 1047:if(!this.normal)return e={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs},this.reset(),this.normal=e,this.showCursor()}}else for(d=b.length,c=0;d>c;)this.setMode(b[c]),c++},a.prototype.resetMode=function(a){var b,c;if("object"!=typeof a){if("?"===this.prefix)switch(a){case 1:return this.applicationCursor=!1;case 3:return 132===this.cols&&this.savedCols&&this.resize(this.savedCols,this.rows),delete this.savedCols;case 6:return this.originMode=!1;case 7:return this.wraparoundMode=!1;case 66:return this.applicationKeypad=!1;case 9:case 1e3:case 1002:case 1003:return this.x10Mouse=!1,this.vt200Mouse=!1,this.normalMouse=!1,this.mouseEvents=!1,this.element.style.cursor="";case 1004:return this.sendFocus=!1;case 1005:return this.utfMouse=!1;case 1006:return this.sgrMouse=!1;case 1015:return this.urxvtMouse=!1;case 25:return this.cursorHidden=!0;case 1049:case 47:case 1047:if(this.normal)return this.lines=this.normal.lines,this.ybase=this.normal.ybase,this.ydisp=this.normal.ydisp,this.x=this.normal.x,this.y=this.normal.y,this.scrollTop=this.normal.scrollTop,this.scrollBottom=this.normal.scrollBottom,this.tabs=this.normal.tabs,this.normal=null,this.refresh(0,this.rows-1),this.showCursor()}}else for(c=a.length,b=0;c>b;)this.resetMode(a[b]),b++},a.prototype.setScrollRegion=function(a){return this.prefix?void 0:(this.scrollTop=(a[0]||1)-1,this.scrollBottom=(a[1]||this.rows)-1,this.x=0,this.y=0)},a.prototype.saveCursor=function(a){return this.savedX=this.x,this.savedY=this.y},a.prototype.restoreCursor=function(a){return this.x=this.savedX||0,this.y=this.savedY||0},a.prototype.cursorForwardTab=function(a){var b,c;for(b=a[0]||1,c=[];b--;)c.push(this.x=this.nextStop());return c},a.prototype.scrollUp=function(a){var b;for(b=a[0]||1;b--;)this.lines.splice(this.ybase+this.scrollTop,1),this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine());return this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},a.prototype.scrollDown=function(a){var b;for(b=a[0]||1;b--;)this.lines.splice(this.ybase+this.scrollBottom,1),this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine());return this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},a.prototype.initMouseTracking=function(a){},a.prototype.resetTitleModes=function(a){},a.prototype.cursorBackwardTab=function(a){var b,c;for(b=a[0]||1,c=[];b--;)c.push(this.x=this.prevStop());return c},a.prototype.repeatPrecedingCharacter=function(a){var b,c,d,e;for(d=a[0]||1,c=this.lines[this.ybase+this.y],b=c[this.x-1]||[this.defAttr," "],e=[];d--;)e.push(c[this.x++]=b);return e},a.prototype.tabClear=function(a){var b;return b=a[0],0>=b?delete this.tabs[this.x]:3===b?this.tabs={}:void 0},a.prototype.mediaCopy=function(a){},a.prototype.setResources=function(a){},a.prototype.disableModifiers=function(a){},a.prototype.setPointerMode=function(a){},a.prototype.softReset=function(a){return this.cursorHidden=!1,this.insertMode=!1,this.originMode=!1,this.wraparoundMode=!1,this.applicationKeypad=!1,this.applicationCursor=!1,this.scrollTop=0,this.scrollBottom=this.rows-1,
this.curAttr=this.defAttr,this.x=this.y=0,this.charset=null,this.glevel=0,this.charsets=[null]},a.prototype.requestAnsiMode=function(a){},a.prototype.requestPrivateMode=function(a){},a.prototype.setConformanceLevel=function(a){},a.prototype.loadLEDs=function(a){},a.prototype.setCursorStyle=function(a){},a.prototype.setCharProtectionAttr=function(a){},a.prototype.restorePrivateValues=function(a){},a.prototype.setAttrInRectangle=function(a){var b,c,d,e,f,g,h;for(h=a[0],e=a[1],c=a[2],g=a[3],b=a[4];c+1>h;){for(f=this.lines[this.ybase+h],d=e;g>d;)f[d]=[b,f[d][1]],d++;h++}return this.updateRange(a[0]),this.updateRange(a[2])},a.prototype.savePrivateValues=function(a){},a.prototype.manipulateWindow=function(a){},a.prototype.reverseAttrInRectangle=function(a){},a.prototype.setTitleModeFeature=function(a){},a.prototype.setWarningBellVolume=function(a){},a.prototype.setMarginBellVolume=function(a){},a.prototype.copyRectangle=function(a){},a.prototype.enableFilterRectangle=function(a){},a.prototype.requestParameters=function(a){},a.prototype.selectChangeExtent=function(a){},a.prototype.fillRectangle=function(a){var b,c,d,e,f,g,h;for(c=a[0],h=a[1],e=a[2],b=a[3],g=a[4];b+1>h;){for(f=this.lines[this.ybase+h],d=e;g>d;)f[d]=[f[d][0],String.fromCharCode(c)],d++;h++}return this.updateRange(a[1]),this.updateRange(a[3])},a.prototype.enableLocatorReporting=function(a){var b;return b=a[0]>0},a.prototype.eraseRectangle=function(a){var b,c,d,e,f,g,h;for(h=a[0],e=a[1],b=a[2],g=a[3],c=[this.eraseAttr()," "];b+1>h;){for(f=this.lines[this.ybase+h],d=e;g>d;)f[d]=c,d++;h++}return this.updateRange(a[0]),this.updateRange(a[2])},a.prototype.setLocatorEvents=function(a){},a.prototype.selectiveEraseRectangle=function(a){},a.prototype.requestLocatorPosition=function(a){},a.prototype.insertColumns=function(){var a,b,c,d;for(d=params[0],c=this.ybase+this.rows,a=[this.eraseAttr()," "];d--;)for(b=this.ybase;c>b;)this.lines[b].splice(this.x+1,0,a),this.lines[b].pop(),b++;return this.maxRange()},a.prototype.deleteColumns=function(){var a,b,c,d;for(d=params[0],c=this.ybase+this.rows,a=[this.eraseAttr()," "];d--;)for(b=this.ybase;c>b;)this.lines[b].splice(this.x,1),this.lines[b].push(a),b++;return this.maxRange()},a.prototype.get_html_height_in_lines=function(a){var b,c;return c=document.createElement("div"),c.innerHTML=a,this.element.appendChild(c),b=c.getBoundingClientRect().height,this.element.removeChild(c),Math.ceil(b/this.char_size.height)},a.prototype.charsets={SCLD:{"`":"◆",a:"▒",b:"	",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},UK:null,US:null,Dutch:null,Finnish:null,French:null,FrenchCanadian:null,German:null,Italian:null,NorwegianDanish:null,Spanish:null,Swedish:null,Swiss:null,ISOLatin:null},a}(),window.Terminal=c}).call(this);
//# sourceMappingURL=main.min.js.map